<div class="row">
  <div class="col-xs-12" fire-loading="loaded">
    <div class="alert" ng-class="{'alert-danger': dataUpdated}">
      <button class="btn btn-default" ng-click="recordActivity()">
        <i class="fa fa-plus"></i>
        Activity
      </button>
      <button class="btn pull-right" ng-class="{'btn-default': !dataUpdated, 'btn-danger': dataUpdated}" ng-click="saveChanges()">
        <i class="fa fa-floppy-o"></i>
        Save
      </button>
      <span class="pull-right" ng-show="dataUpdated">
        <i class="fa fa-lg fa-exclamation-triangle"></i>
        Updates have been detected. Save now!
      </span>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xs-12" fire-loading="loaded">
    <table class="table table-striped table-finances" float-thead="floatTheadOptions" ng-model="savings">
      <thead>
        <tr>
          <th colspan="2"></th>
          <th class="separator" colspan="6">Revenues</th>
          <th class="separator" colspan="2">Total</th>
          <th colspan="1" style="width: 70px">Perf</th>
        </tr>
        <tr>
          <th></th>
          <th class="separator">Savings</th>
          <th ng-repeat="h in headersLine" ng-class="{'separator': h.last}">{{ h.label }}</th>
          <th>Post</th>
          <th class="separator">Pre</th>
          <th>SR</th>
        </tr>
      </thead>
      <tbody ng-repeat="(year, year_income) in income">
        <tr>
          <td class="td-chevron">
            <div tooltip-placement="right" uib-tooltip="{{year_headers.collapsed[year]?year:''}}">
              <fire-collapse-toggle flag="year_headers.collapsed[year]"></fire-collapse-toggle>
            </div>
          </td>
          <td ng-hide="year_headers.collapsed[year]" colspan="{{headersLine.length + 4}}">
            <span class="pull-left" style="padding-left: 10px">
              {{ year }}
            </span>
          </td>
          <td ng-show="year_headers.collapsed[year]">{{ yearlySavings(year) | amount:true }}</td>
          <td ng-show="year_headers.collapsed[year]" ng-repeat="header in headersLine">
            {{ yearlyIncome(year, header) | amount:true }}
          </td>
          <td ng-show="year_headers.collapsed[year]">{{ totalYearPost(year) | amount:true }}</td>
          <td ng-show="year_headers.collapsed[year]">{{ totalYearPre(year) | amount:true }}</td>
          <td ng-show="year_headers.collapsed[year]">
            {{ savingRateYear(year) * 100| number :2 }}%
          </td>
        </tr>
        <tr ng-repeat="(month, amounts) in year_income" ng-hide="year_headers.collapsed[year]">
          <td>{{ month }}</td>
          <td>{{ income[year][month].savings | amount }}</td>
          <td ng-repeat="header in headersLine">
            <fire-amount type="'R'" id="header.id" institution="income[year][month].income" ></fire-amount>
          </td>
          <td ng-show="totalMonth(year, month) === 0" colspan="3"></td>
          <td ng-hide="totalMonth(year, month) === 0">{{ totalMonthPost(year, month) | amount:true }}</td>
          <td ng-hide="totalMonth(year, month) === 0">{{ totalMonthPre(year, month) | amount:true }}</td>
          <td ng-hide="totalMonth(year, month) === 0" ng-class="{'danger': savingRateMonth(year, month) < 0.5, 'success': savingRateMonth(year, month) >= 0.5}">
            {{savingRateMonth(year, month) * 100| number :2 }}%
            <span></span>
          </td>
        </tr>
        <tr class="tr-total" ng-hide="year_headers.collapsed[year]">
          <td><i class="fa fa-calendar-plus-o"></i></td>
          <td>{{ yearlySavings(year) | amount:true }}</td>
          <td ng-repeat="header in headersLine">{{ yearlyIncome(year, header) | amount:true }}</td>
          <td>{{ totalYearPost(year) | amount:true }}</td>
          <td>{{ totalYearPre(year) | amount:true }}</td>
          <td ng-class="{'danger': savingRateYear(year) < 0.5, 'success': savingRateYear(year) >= 0.5}">
            {{ savingRateYear(year) * 100 | number:2 }}%
          </td>
        </tr>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="col-xs-12" fire-loading="loaded">
    <div class="alert" ng-class="{'alert-danger': dataUpdated}">
      <button class="btn btn-default" ng-click="recordActivity()">
        <i class="fa fa-plus"></i>
        Activity
      </button>
      <button class="btn pull-right" ng-class="{'btn-default': !dataUpdated, 'btn-danger': dataUpdated}" ng-click="saveChanges()">
        <i class="fa fa-floppy-o"></i>
        Save
      </button>
      <span class="pull-right" ng-show="dataUpdated">
        <i class="fa fa-lg fa-exclamation-triangle"></i>
        Updates have been detected. Save now!
      </span>
    </div>
  </div>
</div>